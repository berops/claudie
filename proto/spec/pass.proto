syntax = "proto3";
package spec;
option go_package = "github.com/berops/claudie/proto/pb/spec";

enum ErrorLevel {
    ERROR_FATAL = 0;
    ERROR_WARN = 1;
}

message StageDescription {
    string about = 1;
    ErrorLevel errorLevel = 2;
}

message StageTerraformer {
    enum SubPassKind {
        BUILD_INFRASTRUCTURE = 0;
        UPDATE_INFRASTRUCTURE = 1;
        DESTROY_INFRASTRUCTURE = 2;
    }
    message SubPass {
        SubPassKind kind = 1;
        StageDescription description = 2;
    }

    StageDescription description = 1;
    repeated SubPass subPasses = 2;
}

message StageAnsibler {
    enum SubPassKind {
        INSTALL_NODE_REQUIREMENTS = 0;
        INSTALL_VPN = 1;
        DETERMINE_API_ENDPOINT_CHANGE = 2;
        RECONCILE_LOADBALANCERS = 3;
        REMOVE_CLAUDIE_UTILITIES = 4;
        UPDATE_API_ENDPOINT = 5;
        UPDATE_PROXY_ENVS_ON_NODES_FOR_K8S = 6;
        UPDATE_PROXY_ENVS_ON_NODES = 7;
    }
    message SubPass {
        SubPassKind kind = 1;
        StageDescription description = 2;
    }
    StageDescription description = 1;
    repeated SubPass subPasses = 2;
}

message StageKubeEleven {
    enum SubPassKind {
        RECONCILE_CLUSTER = 0;
        DESTROY_CLUSTER = 1;
    }
    message SubPass {
        SubPassKind kind = 1;
        StageDescription description = 2;
    }
    StageDescription description = 1;
    repeated SubPass subPasses = 2;
}

message StageKuber {
    enum SubPassKind {
        TODO = 0;
    }
    message SubPass {
        SubPassKind kind = 1;
        StageDescription description = 2;
    }
    StageDescription description = 1;
    repeated SubPass subPasses = 2;
}

message Stage {
    oneof StageKind {
        StageTerraformer terraformer = 1;
        StageAnsibler ansibler = 2;
        StageKubeEleven kubeEleven = 3;
        StageKuber kuber = 4;
    }
}
